<?php
require_once("../../../src/session.php");
require("../../../FreeSpace.php");
?>
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>MiPc</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS and API chart google-->
        <link href="css/styles.css" rel="stylesheet" />
        <link href="css/styles_extra.css" rel="stylesheet" />
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript" src="https://rawgit.com/louisremi/jquery-smartresize/master/jquery.throttledresize.js"></script>
        <!-- JQuery and (includes Bootstrap)-->
        <link href="/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
        <!--<script src="/node_modules/jquery.scrollto/jquery.scrollTo.min.js"></script>-->
        <!--<script src="/node_modules/jquery/dist/jquery.min.js"></script>-->
        <!-- External Tour -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/kineticjs/5.2.0/kinetic.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.2/jquery.scrollTo.min.js"></script>
        <!-- Enjoyhint library -->
        <link href="/node_modules/xbs-enjoyhint/enjoyhint.css" rel="stylesheet">
        <script src="/node_modules/xbs-enjoyhint/enjoyhint.min.js"></script>
    </head>
    <body style="background-color:#242629;" >
        <main class="flex-shrink-0">
        <div id="panel">  
            <!-- Navigation-->
            <nav style="background-color:#16161a;" class="navbar navbar-dark ">
                <div class="container px-5">
                    <a class="navbar-brand" href="index.php">
                        <?php
                        echo 'Usuario : '.$_SESSION['Name-User'];
                        ?>
                    </a>
                    <a  class="badge" >Conexion: <?php echo "Establecida"?></a>
                    <a  class="badge badge-danger" href="/node_modules/startbootstrap-modern-business/dist/cerrar.php">Salir</a>
                    
                </div>
            </nav>
            <!-- Header-->
            <header style="background-color:#16161a;" >
                <div class="container px-5">
                    <div class="row gx-5 align-items-center justify-content-center">
                        <div class="col-lg-8 col-xl-7 col-xxl-6">
                            <div class="my-5 text-center text-xl-start">
                                <h1 class="display-5 fw-bolder text-white mb-2">Tu Espacio</h1>
                                <p  style="color:#94a1b2;" class="lead fw-normal mb-4">Acceso sencillo y seguro a tu contenido <br> Guarda y comparte  archivos y carpetas desde tu dispositivo móvil, tablet u ordenador</p>
                                <div class="d-grid gap-3 d-sm-flex justify-content-sm-center justify-content-xl-start">
                                    <a id='upload' style="background-color:#7f5af0;" class="btn btns btn-lg px-4 me-sm-3" href="/upload/index.php">Subir Archivo <i class="bi bi-upload"></i></a>
                                    <a id='tutorial' onclick="tutorial()" style="background-color:#2cb67d;" class="btn btns btn-lg px-4 me-sm-3" >Tutorial</a>
                                </div>
                            </div>
                        </div>
                        <div  id="chart" class="col-xl-5 col-xxl-6 d-xl-block text-center A">
                            <div id="chart_wrap"><div id="chart_div"></div></div>
                        </div>
                        
                    </div>
                    
                </div>
                
            </header>
        </div>
            <br>
            <!-- Features section SSD  -->
            <section  >
                <h2 id="private" style="color:#fffffe;margin-left:10px" class="fw-bolder">Contenido  Público<i onclick="a()" type="submit" class="bi bi-arrow-clockwise"></i></h2>
                <div  class="containerr B">
                    <?php
                            
                            // Nota: el resultado es protocolo agnostic
                            $link = $_SERVER[ 'HTTP_HOST'] ;
                            $escaped_link = htmlspecialchars($link, ENT_QUOTES, 'UTF-8');
                            if($link=='localhost' | $link=='192.168.1.65' )$SSL = 'http';
                            else $SSL = 'https';
                            echo '<iframe  id="iframe_1" src="'.$SSL.'://'.$escaped_link.'/allUser/prueba/" frameborder="0" scrolling="yes"  allowfullscreen></iframe>'
                    ?>

                </div>
            </section>

            <section>
                <h2 style="color:#fffffe;margin-top:50px;margin-left:10px;"  class="fw-bolder ">Contenido Privado <i onclick="b()" type="submit" class="bi bi-arrow-clockwise"></i></h2>
                <div class="containerr C" >
                    <?php
                        $temp = $_SESSION['Name-User'];
                        $temp2 = $SSL.'://'.$escaped_link.'/anime/user/';
                        echo $temp2;
                        echo '<iframe  src="'.$temp2.'" frameborder="0" scrolling="yes" allowfullscreen></iframe>'
                    ?>
                    
                </div>
            </section>    
        </main>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>


<script  type="text/javascript">
//initialize instance
function tutorial(){
    var enjoyhint_instance = new EnjoyHint({});

    //simple config. 
    //Only one step - highlighting(with description) "New" button 
    //hide EnjoyHint after a click on the button.
    var enjoyhint_script_steps = [
    {
        'next #panel' : 'Este es tu panel de Usuario donde contiene información importante'
    },
    {
        'next #chart' : 'Este gráfico muestra el porcentaje de memoria que has utilizado, al ser un nuevo usuario tienes asignado 10GB'
    },
    {
        'next #upload' : 'Aqui podrás subir contenido a tu panel privado (En tu panel privado también puedes subir contenido)'
    },
    {
        'next #tutorial' : 'Si quieres volver a recordar el tutorial pulsa aquí'
    },
    {
        'next #private' : 'A partir de este punto tienes Panel Publico, donde todos los cambios que realizar seran publicos a todos los usuarios, y el Panel Privado, donde podras subir hasta 10 GB de contenido de forma privada'
    }
    ];

    //set script config
    enjoyhint_instance.set(enjoyhint_script_steps);

    //run Enjoyhint script
    enjoyhint_instance.run();
}   
google.charts.load("visualization", "1", {packages:["corechart"]});
google.charts.setOnLoadCallback(drawChart);
function drawChart() {

    const mem= "<?php echo $_SESSION['MEM'] ?>";
    const memc= "<?php echo $_SESSION['Limit'] ?>";
    const memMB= mem*(9.31*10**(-10));
    const free = memc-memMB;
    //alert(memc);
    var data = google.visualization.arrayToDataTable([
    ['Tipo', 'GB'],
    ['Libre (GB)',     free],
    ['Usado (GB)',      memMB],
    ]);

    var options = {
    title: '',
    is3D: true,
    backgroundColor: '#16161a',
    colors:['#2cb67d','red'],
    legend:{position: 'top', textStyle: {color: 'white', fontSize: 16}},
    responsive: true,

    };

    var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
    chart.draw(data, options);
}
$(window).on("throttledresize", function (event) {
var options = {
width: '100%',
height: '100%'
};

var data = google.visualization.arrayToDataTable([]);
drawChart(data, options);
});
</script>
<?php 
include("/src/bd.php");
if($_SESSION['state_tuto']==0){
    $query = mysqli_query($conn,"UPDATE user SET tutorial = 1 WHERE User = '".$_SESSION['Name-User']."' ");
    $_SESSION['state_tuto']=1;
    echo "<script> tutorial(); </script>"; 
}

?>